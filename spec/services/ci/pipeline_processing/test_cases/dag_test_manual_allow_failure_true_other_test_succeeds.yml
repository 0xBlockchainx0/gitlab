config:
  test1:
    stage: test
    script: exit 0

  test2:
    stage: test
    when: manual
    allow_failure: true
    script: exit 0

  deploy:
    stage: deploy
    script: exit 0
    needs: [test1, test2]

init:
  expect:
    pipeline: pending
    stages:
      test: pending
      deploy: created
    jobs:
      test1: pending
      test2: manual
      deploy: created

transitions:
  - event: success
    jobs: [test1]
    expect:
      pipeline: running
      stages:
        test: success
        deploy: created
      jobs:
        test1: success
        test2: manual
        deploy: created

  - event: enqueue
    jobs: [test2]
    expect:
      pipeline: running
      stages:
        test: running
        deploy: created
      jobs:
        test1: success
        test2: pending
        deploy: created

  - event: success
    jobs: [test2]
    expect:
      pipeline: running
      stages:
        test: success
        deploy: pending
      jobs:
        test1: success
        test2: success
        deploy: pending
